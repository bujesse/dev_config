session_name: execution
suppress_history: false
windows:
  - window_name: execution-ui
    shell_command_before:
      - cd /projects/execution-ui
      - n -S ~/.cache/nvim/sessions/execution-ui
  - window_name: execution
    layout: tiled
    shell_command_before:
      - cd /projects/execution/
      - source venv/bin/activate.fish
      - n -S ~/.cache/nvim/sessions/execution
  - window_name: flask-logs
    layout: tiled
    shell_command_before:
      - cd /projects/execution/
      - touch output.log
      - lnav output.log
  - window_name: flask-proc
    layout: 4ca9,252x57,0,0{174x57,0,0,2,77x57,175,0[77x28,175,0,18,77x28,175,29,19]}
    panes:
      - shell_command_before:
          - cd /projects/execution/
          - source venv/bin/activate.fish
          # - flask run execution:create_app() --host=0.0.0.0 --port=5010 --without-threads
          # - python -m debugpy --listen localhost:5678 -m flask run execution:create_app() --host=0.0.0.0 --port=5010 --without-threads --no-reload
          # - watchexec -r -e py -- python -m debugpy --listen localhost:5678 -m flask run execution:create_app() --host=0.0.0.0 --port=5010 --without-threads --no-reload
          - fd -e py | entr -r python -m debugpy --listen localhost:5678 -m flask run execution:create_app() --host=0.0.0.0 --port=5010 --without-threads --no-reload | head -c 5M > output.log
        environment:
          FLASK_ENV: development
          FLASK_DEBUG: "1"
          LOG_LEVEL: debug
      - shell_command:
          # Watch for debugpy processes
          - watch --color -n 2 "ps aux | rg -inH [d]ebugpy"
      - shell_command:
          # Watch for ports 5678
          - watch -c -n 2 "sudo lsof -i -P -n | rg 5678"
  - window_name: execution-tests
    layout: tiled
    shell_command_before:
      - cd /projects/execution/
      - source venv/bin/activate.fish
      - fd -e py | entr -r python -m pytest -vv --disable-warnings tests/
